cpsvpn
======
Форк проекта [CPYVPN](https://gitlab.com/cpvpn/cpyvpn).  
Добавлен класс VNASD, позволяющий работать в режиме systemd-networkd/systemd-resolved.  
Приоритет нового класса [почти минимальный](cpyvpn/vna.py#L507), сначала пробуется режим NetworkManager (VNANM).  

Установка
=========
Клонировать репу, зайти в каталог и выполнить:  
*pip install -r requirements.txt*  
Имя  интерфейса __*tunsnx*__ должно быть свободным или потребуется указать другое имя через параметр *-i*.  
Для запуска от простого пользователя надо добавить __NET_ADMIN__ для пайтона:   
*setcap cap_net_admin+eip python* (не работает для ссылок. В случае с VENV заменил ссылку копией пайтона)  
*getcap python* - проверка должна вывести полный путь пайтона и cap_net_admin=eip  
 Пользователь должен обладать правами sudo (потребуется для настройки ДНС).  

AD-Пароль и СМС-ОТP
===================
При нежелании вводить АД-пароль каждый раз, его можно спрятать прямо в коде или читать из файла.  
Для этого надо закомментировать [строку](cpyvpn/cui.py#L35) и подставить предложенные варианты.   
Не нашел простого способа передачи ОТР, полученный код из СМС надо записать в переменную [user_input](cpyvpn/auth.py#L136).  

Возможные проблемы
==================
После обновления версии пайтона, требуется переустановка.  

Если не появляется TUN-интерфейс и видим ошибку *Initializing null VNA for debugging. Network packet transfer won't be available*  
значит, что ни один класс виртуального интерфейса не создался(NetworkManager,SystemD).  
Возможно, не хватает CAP_NET_ADMIN, попробуйте выполнить от рута.  
